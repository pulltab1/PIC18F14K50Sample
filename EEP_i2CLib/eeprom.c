/*********************************************
 * EEPROM?????
 *********************************************/

#include <xc.h>
#include <eeprom.h>

/*==============????==============*/

/*********************************************
 * void busyEEPROM ( void )
 * EEPROM?????????????????
 
 *********************************************/
void busyEEPROM (){
	while(EECON1bits.WR);   //????????????????
}

/*********************************************
 * unsigned char readEEPROM ( unsigned char )
 * 
 * EEPROM?badd???????????
 * 
 * ??:??????????   
 * ???:?????????
 *********************************************/
unsigned char readEEPROM( unsigned int badd ){
	
    busyEEPROM();   //??????????????
    
	EEADR = (badd & 0x0ff); //8bit???
  	EECON1bits.CFGS = 0;    //?????????0???
	EECON1bits.EEPGD = 0;   //?????????0???
	EECON1bits.RD = 1;  //?????????
	Nop();
	Nop();  //?????????????
	return ( EEDATA );  //  ?????????????
}


/*********************************************
 * void writeEEPROM ( unsigned int , unsigned char )
 * 
 * EEPROM?badd???bdat?????
 * 
 * ????:??????????
 * ????:??????????
 *********************************************/
void writeEEPROM( unsigned int badd,unsigned char bdat ){
	char GIE_BIT_VAL = 0;   //  ????????????????
	
    busyEEPROM();   //??????????????
    
    EEADR = (badd & 0x0ff);  //8bit???
  	EEDATA = bdat;   //??????????
  	EECON1bits.EEPGD = 0;   //?????????0???
	EECON1bits.CFGS = 0;    //?????????0???
	EECON1bits.WREN = 1;    //??????
	GIE_BIT_VAL = INTCONbits.GIE;   //???????????????????
	INTCONbits.GIE = 0; //  ??????
	EECON2 = 0x55;  //  ????????????
	EECON2 = 0xAA;  //  ????????????
	EECON1bits.WR = 1;  //??????
    
	busyEEPROM(); //EEPROM?????????
	
    INTCONbits.GIE = GIE_BIT_VAL;   //????????????
	EECON1bits.WREN = 0;    //??????
}
